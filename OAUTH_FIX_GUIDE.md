# üîê –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è OAuth —Ç–∞ Gmail API Permissions

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–º–∏–ª–∫–∞ `insufficientPermissions` (403 Forbidden) –æ–∑–Ω–∞—á–∞—î, —â–æ –ø–æ—Ç–æ—á–Ω—ñ credentials –Ω–µ –º–∞—é—Ç—å –≤—Å—ñ—Ö –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤ (scopes) –¥–ª—è –æ–ø–µ—Ä–∞—Ü—ñ—ó DELETE.

## –†—ñ—à–µ–Ω–Ω—è

### 1. –ü–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ scopes

**–ö—Ä–æ–∫ 1:** –û—á–∏—Å—Ç—ñ—Ç—å —Å—Ç–∞—Ä—ñ credentials:
```
https://127.0.0.1:5000/clear-credentials
```

**–ö—Ä–æ–∫ 2:** –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—è –∑–Ω–æ–≤—É:
```
https://127.0.0.1:5000/authorize
```

‚ö†Ô∏è **–í–∞–∂–ª–∏–≤–æ:** –ü—ñ–¥ —á–∞—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ –Ω–∞–¥–∞–ª–∏ **–≤—Å—ñ** –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–æ–∑–≤–æ–ª–∏, –≤–∫–ª—é—á–∞—é—á–∏:
- ‚úÖ Gmail: Read, compose, send, and permanently delete emails
- ‚úÖ Calendar: Create, edit, and delete events

### 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å

–ü–æ—Ç–æ—á–Ω—ñ scopes –≤ `config.py`:
```python
SCOPES = [
    'https://www.googleapis.com/auth/gmail.modify',  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –≤–∫–ª—é—á–∞—î DELETE
    'https://www.googleapis.com/auth/calendar.events'
]
```

### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Google Cloud Console

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤ Google Cloud Console –≤–∞—à OAuth 2.0 Client ID –º–∞—î –Ω–∞—Å—Ç—É–ø–Ω—ñ scopes:

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞: https://console.cloud.google.com/apis/credentials
2. –í–∏–±–µ—Ä—ñ—Ç—å –≤–∞—à OAuth 2.0 Client ID
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –¥–æ–¥–∞–Ω—ñ scopes:
   - `https://www.googleapis.com/auth/gmail.modify`
   - `https://www.googleapis.com/auth/calendar.events`

### 4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö credentials

–ü—ñ—Å–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ (DevTools ‚Üí Application ‚Üí Session Storage):
- `credentials` –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ –ø–æ–ª–µ `scopes` –∑ –æ–±–æ–º–∞ scope

### 5. –Ø–∫—â–æ –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è

–Ø–∫—â–æ –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è:

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ client_secret.json:**
   - –§–∞–π–ª –º–∞—î –±—É—Ç–∏ –≤–∞–ª—ñ–¥–Ω–∏–º JSON
   - –ú—ñ—Å—Ç–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π `client_id` —Ç–∞ `client_secret`

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ BASE_URI:**
   - –ú–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ —Ç–æ–º—É, —â–æ –≤–∫–∞–∑–∞–Ω–æ –≤ Google Cloud Console
   - –î–ª—è localhost: `https://127.0.0.1:5000`
   - Redirect URI –≤ Google Cloud Console –º–∞—î –±—É—Ç–∏: `https://127.0.0.1:5000/callback`

3. **–û—á–∏—Å—Ç—ñ—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞:**
   - –Ü–Ω–æ–¥—ñ –±—Ä–∞—É–∑–µ—Ä –∫–µ—à—É—î —Å—Ç–∞—Ä—ñ credentials

## –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### –ü—Ä–∞–≤–∏–ª—å–Ω—ñ scopes –¥–ª—è Gmail:

- `gmail.modify` - –≤–∫–ª—é—á–∞—î read, compose, send, **delete**, —ñ modify labels
- `gmail.readonly` - —Ç—ñ–ª—å–∫–∏ —á–∏—Ç–∞–Ω–Ω—è (–ù–ï –≤–∫–ª—é—á–∞—î DELETE)
- `gmail` - –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó (—à–∏—Ä—à–µ, –Ω—ñ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ)

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `gmail.modify` - —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! ‚úÖ**

### OAuth Flow:

1. `/authorize` ‚Üí Google OAuth page
2. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–¥–∞—î –¥–æ–∑–≤–æ–ª–∏
3. `/callback` ‚Üí –æ—Ç—Ä–∏–º—É—î–º–æ —Ç–æ–∫–µ–Ω –∑ —É—Å—ñ–º–∞ scopes
4. –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ `session['credentials']`
5. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –¥–ª—è API –≤–∏–∫–ª–∏–∫—ñ–≤

## –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

–ü—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó:
1. Worker –∑–º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ DELETE –æ–ø–µ—Ä–∞—Ü—ñ—ó
2. –í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º—É—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ
3. –ü–æ–º–∏–ª–∫–∏ 403 Forbidden –∑–Ω–∏–∫–Ω—É—Ç—å

