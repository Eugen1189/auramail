# üö¶ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–µ—à—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ç–µ—Å—Ç—ñ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

`TestIndexRoute::test_index_shows_dashboard_when_authenticated` –ø–∞–¥–∞–≤ —á–µ—Ä–µ–∑ `KeyError` —É –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ñ `@cache.cached()`. –¶–µ –≤—ñ–¥–±—É–≤–∞–ª–æ—Å—è, –æ—Å–∫—ñ–ª—å–∫–∏ –∫–µ—à –Ω–µ –±—É–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.

## –†—ñ—à–µ–Ω–Ω—è

### ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ app_factory.py

**–î–æ–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è TESTING —Ä–µ–∂–∏–º—É:**
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–º—ñ–Ω–Ω–æ—ó –æ—Ç–æ—á–µ–Ω–Ω—è `TESTING`
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ `app.config['TESTING']`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è `NullCache` –¥–ª—è —Ç–µ—Å—Ç—ñ–≤

**–ö–æ–¥:**
```python
# Check for TESTING mode from environment or config
import os
is_testing = os.getenv('TESTING', 'False').lower() in ('true', '1', 'yes')
if not is_testing:
    is_testing = app.config.get('TESTING', False)
app.config['TESTING'] = is_testing

# Configure cache based on TESTING mode
if app.config.get('TESTING', False):
    cache_config = {
        'CACHE_TYPE': 'NullCache',
        'CACHE_NO_NULL_WARNING': True
    }
    app.config['CACHE_TYPE'] = 'NullCache'
```

### ‚úÖ –°–ø—Ä–æ—â–µ–Ω–æ conftest.py

**–í–∏–¥–∞–ª–µ–Ω–æ –¥—É–±–ª—é—é—á—É –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∫–µ—à—É:**
- –¢–µ–ø–µ—Ä `conftest.py` –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î `TESTING=True` –ø–µ—Ä–µ–¥ —ñ–º–ø–æ—Ä—Ç–æ–º
- `app_factory` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤—É—î `NullCache`
- –ú–µ–Ω—à–µ –∫–æ–¥—É, –ø—Ä–æ—Å—Ç—ñ—à–∞ –ª–æ–≥—ñ–∫–∞

**–ö–æ–¥:**
```python
# Set TESTING environment variable before importing server
import os
os.environ['TESTING'] = 'True'

# Import app factory directly (not server, to avoid circular issues)
from app_factory import create_app

# Create app - app_factory will detect TESTING and use NullCache
flask_app = create_app()
```

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### 1. –ü—Ä–∏ –∑–∞–ø—É—Å–∫—É —Ç–µ—Å—Ç—ñ–≤

```
conftest.py –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î TESTING=True –≤ environment
  ‚Üì
app_factory.create_app() –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
  ‚Üì
–ü–µ—Ä–µ–≤—ñ—Ä—è—î os.getenv('TESTING') ‚Üí True
  ‚Üì
–ù–∞–ª–∞—à—Ç–æ–≤—É—î CACHE_TYPE='NullCache'
  ‚Üì
cache.init_app() –∑ NullCache
  ‚Üì
‚úÖ –ö–µ—à –ø—Ä–∞—Ü—é—î, –∞–ª–µ –Ω–µ –∫–µ—à—É—î (NullCache —ñ–≥–Ω–æ—Ä—É—î decorators)
```

### 2. –ü—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ —Ç–µ—Å—Ç—É

```
–¢–µ—Å—Ç –≤–∏–∫–ª–∏–∫–∞—î @cache.cached() –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä
  ‚Üì
NullCache –æ–±—Ä–æ–±–ª—è—î –≤–∏–∫–ª–∏–∫
  ‚Üì
–ü—Ä–æ—Å—Ç–æ –ø–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü—ñ—ó (–±–µ–∑ –∫–µ—à—É–≤–∞–Ω–Ω—è)
  ‚Üì
‚úÖ –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
```

## –ü–µ—Ä–µ–≤–∞–≥–∏

### 1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ Flask-Caching
- ‚úÖ `NullCache` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å–ø–æ—Å—ñ–± –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∫–µ—à—É –≤ —Ç–µ—Å—Ç–∞—Ö
- ‚úÖ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è, –∞–ª–µ –Ω–µ –∫–µ—à—É—é—Ç—å
- ‚úÖ –ù–µ–º–∞—î –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –º–æ–∫–∞—Ç–∏ –∞–±–æ –æ–±—Ö–æ–¥–∏—Ç–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∏

### 2. –ü—Ä–æ—Å—Ç—ñ—à–∞ –ª–æ–≥—ñ–∫–∞
- ‚úÖ –í—Å—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∫–µ—à—É –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ (`app_factory`)
- ‚úÖ `conftest.py` –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—ó –ª–æ–≥—ñ–∫–∏
- ‚úÖ –õ–µ–≥—à–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏

### 3. –ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å
- ‚úÖ –ü—Ä–∞—Ü—é—î –¥–ª—è –≤—Å—ñ—Ö —Ç–µ—Å—Ç—ñ–≤
- ‚úÖ –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–æ–∫–∞—Ç–∏ –∫–æ–∂–µ–Ω —Ç–µ—Å—Ç –æ–∫—Ä–µ–º–æ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞

–î–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏
pytest tests/test_server_routes.py::TestIndexRoute::test_index_shows_dashboard_when_authenticated -v

# –ú–∞—î –ø—Ä–æ–π—Ç–∏ –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ KeyError
```

## –í–∏—Å–Ω–æ–≤–æ–∫

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –≤–∏—Ä—ñ—à–µ–Ω–∞:**
- NullCache –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –≤ app_factory
- –¢–µ—Å—Ç–∏ –ø—Ä–∞—Ü—é—é—Ç—å –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ KeyError
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ Flask-Caching

‚úÖ **–ö–æ–¥ –ø—Ä–æ—Å—Ç—ñ—à–∏–π:**
- –ú–µ–Ω—à–µ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏
- –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
- –õ–µ–≥—à–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏
